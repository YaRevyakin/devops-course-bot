Policy as Code

–ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º –∏ –ª—É—á—à–∏—Ö –ø—Ä–∞–∫—Ç–∏–∫ —á–µ—Ä–µ–∑ –¥–µ–∫–ª–∞—Ä–∞—Ç–∏–≤–Ω—ã–µ –ø–æ–ª–∏—Ç–∏–∫–∏, —Ö—Ä–∞–Ω—è—â–∏–µ—Å—è –≤ Git –∏ —Ç–µ—Å—Ç–∏—Ä—É–µ–º—ã–µ –∫–∞–∫ –æ–±—ã—á–Ω—ã–π –∫–æ–¥. 
–ü–æ–∑–≤–æ–ª—è–µ—Ç ¬´—Å–¥–≤–∏–≥–∞—Ç—å –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤–ª–µ–≤–æ¬ª (shift left) ‚Äî –µ—â—ë –¥–æ –ø–æ–ø–∞–¥–∞–Ω–∏—è –≤ –∫–ª–∞—Å—Ç–µ—Ä.

üîë –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

- Open Policy Agent (OPA)  
  –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –¥–≤–∏–∂–æ–∫ –ø–æ–ª–∏—Ç–∏–∫ –Ω–∞ —è–∑—ã–∫–µ Rego. –ú–æ–∂–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å –æ—Ç–¥–µ–ª—å–Ω–æ –∏–ª–∏ –∫–∞–∫ admission controller –≤ Kubernetes.
- Gatekeeper  
  –û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π –∞–¥–¥–æ–Ω OPA –¥–ª—è Kubernetes. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç CRD (ConstraintTemplate, Constraint) –¥–ª—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª.
- Checkov  
  –°–∫–∞–Ω–µ—Ä IaC (Terraform, CloudFormation, ARM) –Ω–∞ —Å–æ—Ç–Ω–∏ –ø—Ä–µ–¥–æ–ø—Ä–µ–¥–µ–ª—ë–Ω–Ω—ã—Ö –ø–æ–ª–∏—Ç–∏–∫ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ (CIS, PCI-DSS –∏ –¥—Ä.).
- Trivy  
  –ê–Ω–∞–ª–∏–∑–∏—Ä—É–µ—Ç –æ–±—Ä–∞–∑—ã –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–æ–≤, —Ñ–∞–π–ª—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π (SBOM) –∏ –∫–æ–Ω—Ñ–∏–≥–∏ Kubernetes –Ω–∞ —É—è–∑–≤–∏–º–æ—Å—Ç–∏ –∏ –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏.
- CI/CD Integration  
  –ü–æ–ª–∏—Ç–∏–∫–∏ –∑–∞–ø—É—Å–∫–∞—é—Ç—Å—è –Ω–∞ —ç—Ç–∞–ø–µ PR: –µ—Å–ª–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–µ ‚Äî —Å–±–æ—Ä–∫–∞ –ø–∞–¥–∞–µ—Ç, –º–µ—Ä–∂ –∑–∞–ø—Ä–µ—â—ë–Ω.

‚öôÔ∏è –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç –≤–º–µ—Å—Ç–µ?

1. –ö–æ–º–∞–Ω–¥–∞ –ø–∏—à–µ—Ç –ø–æ–ª–∏—Ç–∏–∫—É –≤ Rego (–Ω–∞–ø—Ä–∏–º–µ—Ä: ¬´–∑–∞–ø—Ä–µ—Ç–∏—Ç—å latest-—Ç–µ–≥ –≤ image¬ª).
2. –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –µ—ë –≤ Git –∫–∞–∫ ConstraintTemplate.
3. –°–æ–∑–¥–∞—ë—Ç Constraint, –ø—Ä–∏–º–µ–Ω—è—é—â–∏–π –ø—Ä–∞–≤–∏–ª–æ –∫–æ –≤—Å–µ–º namespace.
4. –ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ Pod Gatekeeper –≤—ã–∑—ã–≤–∞–µ—Ç OPA ‚Üí –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –º–∞–Ω–∏—Ñ–µ—Å—Ç ‚Üí –±–ª–æ–∫–∏—Ä—É–µ—Ç, –µ—Å–ª–∏ –Ω–∞—Ä—É—à–µ–Ω–∏–µ.
5. –í CI –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è Checkov (–Ω–∞ Terraform) –∏ Trivy (–Ω–∞ –æ–±—Ä–∞–∑—ã) ‚Äî –≤—Å—ë –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏.

‚Üí –ë–µ–∑ Policy as Code ‚Äî –æ—à–∏–±–∫–∏ –Ω–∞—Ö–æ–¥—è—Ç –≤ production. –° –Ω–∏–º ‚Äî –µ—â—ë –Ω–∞ —ç—Ç–∞–ø–µ pull request.
‚ö†Ô∏è –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏

- ‚ùå ¬´–ù–∞–ø–∏—Å–∞–ª –ø–æ–ª–∏—Ç–∏–∫—É, –Ω–æ –Ω–µ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–ª ‚Äî –∑–∞–±–ª–æ–∫–∏—Ä–æ–≤–∞–ª –≤–µ—Å—å –¥–µ–ø–ª–æ–π¬ª  
  ‚Üí –í—Å–µ–≥–¥–∞ –∏—Å–ø–æ–ª—å–∑—É–π audit-—Ä–µ–∂–∏–º –ø–µ—Ä–µ–¥ enforcement.
- ‚ùå ¬´–ü—Ä–æ–≤–µ—Ä—è—é —Ç–æ–ª—å–∫–æ Kubernetes, –Ω–æ –Ω–µ IaC¬ª  
  ‚Üí –£—è–∑–≤–∏–º–æ—Å—Ç—å –º–æ–∂–µ—Ç –±—ã—Ç—å –≤ —Å–∞–º–æ–º —Å–æ–∑–¥–∞–Ω–∏–∏ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã (–ø—É–±–ª–∏—á–Ω—ã–π S3, –æ—Ç–∫—Ä—ã—Ç—ã–π security group).
- ‚ùå ¬´–ò–≥–Ω–æ—Ä–∏—Ä—É—é false positives ‚Äî –∫–æ–º–∞–Ω–¥–∞ –ø–µ—Ä–µ—Å—Ç–∞—ë—Ç –¥–æ–≤–µ—Ä—è—Ç—å —Å–∏—Å—Ç–µ–º–µ¬ª  
  ‚Üí –ù–∞—Å—Ç—Ä–æ–π –∏—Å–∫–ª—é—á–µ–Ω–∏—è (exceptions) –∏ —Ä–µ–≥—É–ª—è—Ä–Ω–æ –æ–±–Ω–æ–≤–ª—è–π –ø–æ–ª–∏—Ç–∏–∫–∏.

üí° –ì–ª–∞–≤–Ω–æ–µ

Policy as Code ‚Äî —ç—Ç–æ ¬´—Å—Ç—Ä–∞–∂ —É –≤–æ—Ä–æ—Ç¬ª –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã.  
–û–Ω –Ω–µ –∑–∞–º–µ–Ω—è–µ—Ç —Ä—É—á–Ω–æ–π –∞—É–¥–∏—Ç, –Ω–æ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä—É–µ—Ç 80% —Ä—É—Ç–∏–Ω–Ω—ã—Ö –ø—Ä–æ–≤–µ—Ä–æ–∫ –∏ –¥–µ–ª–∞–µ—Ç –∫—É–ª—å—Ç—É—Ä—É –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ–π.

üìå –°–Ω–æ—Å–∫–∏

- Rego ‚Äî —è–∑—ã–∫ –ø–æ–ª–∏—Ç–∏–∫ OPA: https://www.openpolicyagent.org/docs/latest/policy-language/  
- Gatekeeper Library: https://github.com/open-policy-agent/gatekeeper-library  
- Checkov –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç >2500 –ø–æ–ª–∏—Ç–∏–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é.