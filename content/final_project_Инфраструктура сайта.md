---
tags:
  - mod11
---
# ĞŸÑ€Ğ¾ĞµĞºÑ‚: Ğ˜Ğ½Ñ„Ñ€Ğ°ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° ÑĞ°Ğ¹Ñ‚Ğ°

Ğ Ğ°Ğ·Ñ€Ğ°Ğ±Ğ¾Ñ‚ĞºĞ° Ğ¾Ñ‚ĞºĞ°Ğ·Ğ¾ÑƒÑÑ‚Ğ¾Ğ¹Ñ‡Ğ¸Ğ²Ğ¾Ğ¹, Ğ½Ğ°Ğ±Ğ»ÑĞ´Ğ°ĞµĞ¼Ğ¾Ğ¹ Ğ¸ Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ğ·Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ½Ğ¾Ğ¹ Ğ¸Ğ½Ñ„Ñ€Ğ°ÑÑ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ñ‹ Ğ´Ğ»Ñ Ğ²ĞµĞ±-ÑĞ°Ğ¹Ñ‚Ğ° Ğ² Yandex Cloud.
## ğŸ¯ Ğ¦ĞµĞ»ÑŒ
Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‚ÑŒ production-ready ÑĞ¸ÑÑ‚ĞµĞ¼Ñƒ Ñ:
- ĞĞ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¼ Ñ€Ğ°Ğ·Ğ²Ñ‘Ñ€Ñ‚Ñ‹Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼  
- ĞÑ‚ĞºĞ°Ğ·Ğ¾ÑƒÑÑ‚Ğ¾Ğ¹Ñ‡Ğ¸Ğ²Ğ¾ÑÑ‚ÑŒÑ (Ğ±Ğ°Ğ»Ğ°Ğ½ÑĞ¸Ñ€Ğ¾Ğ²Ñ‰Ğ¸Ğº + 2 Ğ’Ğœ)  
- ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ¾Ğ¼ Ğ¸ Ğ»Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼  
- Ğ ĞµĞ·ĞµÑ€Ğ²Ğ½Ñ‹Ğ¼ ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸ĞµĞ¼  
- Ğ‘ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒÑ Ğ¿Ğ¾ ÑƒĞ¼Ğ¾Ğ»Ñ‡Ğ°Ğ½Ğ¸Ñ
---
## ğŸ”§ Ğ­Ñ‚Ğ°Ğ¿Ñ‹ Ñ€ĞµĞ°Ğ»Ğ¸Ğ·Ğ°Ñ†Ğ¸Ğ¸

### 1. Terraform â€” IaC Ğ´Ğ»Ñ Yandex Cloud
- Ğ¡Ğ¾Ğ·Ğ´Ğ°Ñ‘Ñ‚:
  - VPC Ñ Ğ¿Ğ¾Ğ´ÑĞµÑ‚ÑĞ¼Ğ¸ Ğ² `ru-central1-a` Ğ¸ `ru-central1-b`
  - 2 Ğ’Ğœ (web1, web2) Ñ Ğ¿ÑƒĞ±Ğ»Ğ¸Ñ‡Ğ½Ñ‹Ğ¼Ğ¸ IP
  - Network Load Balancer (NLB) Ñ health checks
  - Security groups: Ñ‚Ğ¾Ğ»ÑŒĞºĞ¾ 80/443/22
- Ğ’Ñ‹Ñ…Ğ¾Ğ´: ÑĞ¿Ğ¸ÑĞ¾Ğº IP-Ğ°Ğ´Ñ€ĞµÑĞ¾Ğ² Ğ’Ğœ â†’ Ğ¿ĞµÑ€ĞµĞ´Ğ°Ñ‘Ñ‚ÑÑ Ğ² Ansible

ğŸ“ Ğ¤Ğ°Ğ¹Ğ»Ñ‹: `main.tf`, `variables.tf`, `outputs.tf`, `yandex.tfvars`

---
### 2. Ansible â€” Ğ½Ğ°ÑÑ‚Ñ€Ğ¾Ğ¹ĞºĞ° ĞĞ¡ Ğ¸ ĞŸĞ
- Playbook:
  - Ğ£ÑÑ‚Ğ°Ğ½Ğ°Ğ²Ğ»Ğ¸Ğ²Ğ°ĞµÑ‚ `nginx`, `php-fpm`, `mysql-client`
  - ĞĞ°ÑÑ‚Ñ€Ğ°Ğ¸Ğ²Ğ°ĞµÑ‚ Ğ²Ğ¸Ñ€Ñ‚ÑƒĞ°Ğ»ÑŒĞ½Ñ‹Ğ¹ Ñ…Ğ¾ÑÑ‚ Ğ´Ğ»Ñ ÑĞ°Ğ¹Ñ‚Ğ°
  - ĞšĞ¾Ğ¿Ğ¸Ñ€ÑƒĞµÑ‚ ÑÑ‚Ğ°Ñ‚Ğ¸ĞºÑƒ Ğ¸Ğ· Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ
  - ĞĞ°ÑÑ‚Ñ€Ğ°Ğ¸Ğ²Ğ°ĞµÑ‚ `fail2ban` Ğ¸ `ufw`
- Ğ˜ÑĞ¿Ğ¾Ğ»ÑŒĞ·ÑƒĞµÑ‚ Ğ´Ğ¸Ğ½Ğ°Ğ¼Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ inventory Ğ¸Ğ· `terraform output`

ğŸ“ Ğ¤Ğ°Ğ¹Ğ»Ñ‹: `site-setup.yml`, `roles/webserver/`, `inventory.yml`

---
### 3. CI/CD â€” Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¸Ğ¹ Ğ´ĞµĞ¿Ğ»Ğ¾Ğ¹
- GitLab CI / GitHub Actions:
  - ĞŸÑ€Ğ¸ Ğ¿ÑƒÑˆĞµ Ğ² `main`:
    1. Ğ¡Ğ¾Ğ±Ğ¸Ñ€Ğ°ĞµÑ‚ Ğ°Ñ€Ñ‚ĞµÑ„Ğ°ĞºÑ‚ (ÑÑ‚Ğ°Ñ‚Ğ¸ĞºĞ°)
    2. Ğ—Ğ°Ğ¿ÑƒÑĞºĞ°ĞµÑ‚ `terraform apply` (ĞµÑĞ»Ğ¸ Ğ½ÑƒĞ¶Ğ½Ğ¾)
    3. Ğ’Ñ‹Ğ¿Ğ¾Ğ»Ğ½ÑĞµÑ‚ `ansible-playbook` Ğ½Ğ° Ğ²ÑĞµÑ… Ğ’Ğœ
- Ğ¡ĞµĞºÑ€ĞµÑ‚Ñ‹: Ñ‡ĞµÑ€ĞµĞ· CI/CD variables + `ansible-vault` (Ğ¾Ğ¿Ñ†Ğ¸Ğ¾Ğ½Ğ°Ğ»ÑŒĞ½Ğ¾)

ğŸ“ Ğ¤Ğ°Ğ¹Ğ»: `.gitlab-ci.yml` Ğ¸Ğ»Ğ¸ `.github/workflows/deploy.yml`

---
### 4. ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³ â€” Prometheus Stack
- ĞĞ° ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¹ Ğ’Ğœ: `node_exporter`
- ĞÑ‚Ğ´ĞµĞ»ÑŒĞ½Ğ°Ñ Ğ’Ğœ Ğ¸Ğ»Ğ¸ managed-ĞºĞ»Ğ°ÑÑ‚ĞµÑ€:
  - Prometheus (Ñ Ğ¿Ñ€Ğ°Ğ²Ğ¸Ğ»Ğ°Ğ¼Ğ¸ Ğ°Ğ»ĞµÑ€Ñ‚Ğ¾Ğ²)
  - Grafana (Ñ Ğ´Ğ°ÑˆĞ±Ğ¾Ñ€Ğ´Ğ°Ğ¼Ğ¸)
  - Alertmanager â†’ Telegram/Slack
- ĞĞ»ĞµÑ€Ñ‚Ñ‹:
  - CPU > 90%  
  - Ğ”Ğ¾ÑÑ‚ÑƒĞ¿Ğ½Ğ¾ÑÑ‚ÑŒ ÑĞ°Ğ¹Ñ‚Ğ° < 100%  
  - Ğ¡Ğ²Ğ¾Ğ±Ğ¾Ğ´Ğ½Ğ¾Ğµ Ğ¼ĞµÑÑ‚Ğ¾ Ğ½Ğ° Ğ´Ğ¸ÑĞºĞµ < 10%

ğŸ“ Ğ¤Ğ°Ğ¹Ğ»Ñ‹: `prometheus.yml`, `alerts.yml`, `grafana-dashboards.json`

---
### 5. Ğ›Ğ¾Ğ³Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ â€” Loki Stack
- ĞĞ° ĞºĞ°Ğ¶Ğ´Ğ¾Ğ¹ Ğ’Ğœ: `promtail`
- Loki + Grafana (Ğ¼Ğ¾Ğ¶Ğ½Ğ¾ ÑĞ¾Ğ²Ğ¼ĞµÑÑ‚Ğ¸Ñ‚ÑŒ Ñ Ğ¼Ğ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³Ğ¾Ğ¼)
- Ğ›Ğ¾Ğ³Ğ¸ nginx, php, ÑĞ¸ÑÑ‚ĞµĞ¼Ğ½Ñ‹Ğµ ÑĞ¾Ğ±Ñ‹Ñ‚Ğ¸Ñ
- ĞŸĞ¾Ğ¸ÑĞº Ğ¾ÑˆĞ¸Ğ±Ğ¾Ğº 5xx Ñ‡ĞµÑ€ĞµĞ· Grafana

ğŸ“ Ğ¤Ğ°Ğ¹Ğ»Ñ‹: `loki-config.yaml`, `promtail-config.yaml`

---
### 6. Ğ‘ÑĞºĞ°Ğ¿Ñ‹ â€” Ğ°Ğ²Ñ‚Ğ¾Ğ¼Ğ°Ñ‚Ğ¸Ñ‡ĞµÑĞºĞ¾Ğµ ĞºĞ¾Ğ¿Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ
- Ğ•Ğ¶ĞµĞ´Ğ½ĞµĞ²Ğ½Ñ‹Ğ¹ ÑĞºÑ€Ğ¸Ğ¿Ñ‚ (Ñ‡ĞµÑ€ĞµĞ· cron):
  - `mysqldump` â†’ ÑˆĞ¸Ñ„Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¸Ğµ â†’ Ğ·Ğ°Ğ³Ñ€ÑƒĞ·ĞºĞ° Ğ² **Yandex Object Storage**
  - `rsync` Ñ„Ğ°Ğ¹Ğ»Ğ¾Ğ² ÑĞ°Ğ¹Ñ‚Ğ° â†’ Object Storage
- ĞŸÑ€Ğ¾Ğ²ĞµÑ€ĞºĞ° Ñ†ĞµĞ»Ğ¾ÑÑ‚Ğ½Ğ¾ÑÑ‚Ğ¸ Ñ€Ğ°Ğ· Ğ² Ğ½ĞµĞ´ĞµĞ»Ñ
- RPO = 24 Ñ‡Ğ°ÑĞ°, RTO = 2 Ñ‡Ğ°ÑĞ°

ğŸ“ Ğ¤Ğ°Ğ¹Ğ»: `backup.sh`, `restore.sh`

---
## ğŸ“„ Ğ”Ğ¾ĞºÑƒĞ¼ĞµĞ½Ñ‚Ğ°Ñ†Ğ¸Ñ

### `README.md`
- ĞšĞ°Ğº Ñ€Ğ°Ğ·Ğ²ĞµÑ€Ğ½ÑƒÑ‚ÑŒ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚:
  ```bash
  terraform init && terraform apply -var-file=yandex.tfvars
  ansible-playbook -i inventory.yml site-setup.yml
  ```
- Ğ¢Ñ€ĞµĞ±Ğ¾Ğ²Ğ°Ğ½Ğ¸Ñ: `yc CLI`, `terraform`, `ansible`
- ĞŸĞµÑ€ĞµĞ¼ĞµĞ½Ğ½Ñ‹Ğµ: `yc_token`, `folder_id`, `ssh_key`

### ĞÑ€Ñ…Ğ¸Ñ‚ĞµĞºÑ‚ÑƒÑ€Ğ½Ğ°Ñ Ğ´Ğ¸Ğ°Ğ³Ñ€Ğ°Ğ¼Ğ¼Ğ° (`diagram.png` Ğ¸Ğ»Ğ¸ `draw.io`)

- ĞšĞ¾Ğ¼Ğ¿Ğ¾Ğ½ĞµĞ½Ñ‚Ñ‹:  
    Internet â†’ NLB â†’ [web1, web2] â†’ (MySQL Ğ½Ğ° Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ¾Ğ¹ Ğ’Ğœ Ğ¸Ğ»Ğ¸ managed)  
    ĞœĞ¾Ğ½Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ğ½Ğ³/Ğ›Ğ¾Ğ³Ğ¸ â†’ Ğ¾Ñ‚Ğ´ĞµĞ»ÑŒĞ½Ğ°Ñ Ğ’Ğœ  
    Ğ‘ÑĞºĞ°Ğ¿Ñ‹ â†’ Object Storage
### Ğ§ĞµĞº-Ğ»Ğ¸ÑÑ‚ Ğ¿ĞµÑ€ĞµĞ´ Ğ¿Ñ€Ğ¾Ğ´Ğ°ĞºÑˆĞµĞ½Ğ¾Ğ¼ (`checklist.md`)

- SSL-ÑĞµÑ€Ñ‚Ğ¸Ñ„Ğ¸ĞºĞ°Ñ‚ (Letâ€™s Encrypt Ñ‡ĞµÑ€ĞµĞ· certbot)
- ĞÑ‚ĞºĞ»ÑÑ‡Ñ‘Ğ½ root-Ğ´Ğ¾ÑÑ‚ÑƒĞ¿ Ğ¿Ğ¾ SSH
- ĞĞ°ÑÑ‚Ñ€Ğ¾ĞµĞ½Ñ‹ Ğ°Ğ»ĞµÑ€Ñ‚Ñ‹ Ğ² Alertmanager
- ĞŸÑ€Ğ¾Ñ‚ĞµÑÑ‚Ğ¸Ñ€Ğ¾Ğ²Ğ°Ğ½Ğ¾ Ğ²Ğ¾ÑÑÑ‚Ğ°Ğ½Ğ¾Ğ²Ğ»ĞµĞ½Ğ¸Ğµ Ğ¸Ğ· Ğ±ÑĞºĞ°Ğ¿Ğ°
- Security groups Ğ½Ğµ Ğ¾Ñ‚ĞºÑ€Ñ‹Ğ²Ğ°ÑÑ‚ Ğ»Ğ¸ÑˆĞ½Ğ¸Ğµ Ğ¿Ğ¾Ñ€Ñ‚Ñ‹
- Ğ’ÑĞµ ÑĞµĞºÑ€ĞµÑ‚Ñ‹ Ğ²Ğ½Ğµ Git

---

## ğŸ’¡ ĞŸĞ¾Ñ‡ĞµĞ¼Ñƒ ÑÑ‚Ğ¾ Ğ²Ğ°Ğ¶Ğ½Ğ¾?

> Ğ­Ñ‚Ğ¾Ñ‚ Ğ¿Ñ€Ğ¾ĞµĞºÑ‚ Ğ¾Ğ±ÑŠĞµĞ´Ğ¸Ğ½ÑĞµÑ‚ **Ğ²ÑĞµ ĞºĞ»ÑÑ‡ĞµĞ²Ñ‹Ğµ Ğ½Ğ°Ğ²Ñ‹ĞºĞ¸ DevOps**:
> 
> - IaC (Terraform)
> - ĞšĞ¾Ğ½Ñ„Ğ¸Ğ³ÑƒÑ€Ğ°Ñ†Ğ¸Ñ (Ansible)
> - CI/CD
> - ĞĞ°Ğ±Ğ»ÑĞ´Ğ°ĞµĞ¼Ğ¾ÑÑ‚ÑŒ (Prometheus + Loki)
> - ĞÑ‚ĞºĞ°Ğ·Ğ¾ÑƒÑÑ‚Ğ¾Ğ¹Ñ‡Ğ¸Ğ²Ğ¾ÑÑ‚ÑŒ Ğ¸ Ğ±ĞµĞ·Ğ¾Ğ¿Ğ°ÑĞ½Ğ¾ÑÑ‚ÑŒ
> 
> Ğ­Ñ‚Ğ¾ Ğ³Ğ¾Ñ‚Ğ¾Ğ²Ğ¾Ğµ Ñ€ĞµÑˆĞµĞ½Ğ¸Ğµ Ğ´Ğ»Ñ Ñ€ĞµĞ°Ğ»ÑŒĞ½Ğ¾Ğ³Ğ¾ production-ÑĞ°Ğ¹Ñ‚Ğ°.

## ğŸ—‚ï¸ Ğ¡Ñ‚Ñ€ÑƒĞºÑ‚ÑƒÑ€Ğ° Ñ€ĞµĞ¿Ğ¾Ğ·Ğ¸Ñ‚Ğ¾Ñ€Ğ¸Ñ
```
infra-site/
â”œâ”€â”€ terraform/
â”‚   â”œâ”€â”€ main.tf
â”‚   â””â”€â”€ ...
â”œâ”€â”€ ansible/
â”‚   â”œâ”€â”€ site-setup.yml
â”‚   â””â”€â”€ roles/
â”œâ”€â”€ ci/
â”‚   â””â”€â”€ .gitlab-ci.yml
â”œâ”€â”€ monitoring/
â”‚   â”œâ”€â”€ prometheus.yml
â”‚   â””â”€â”€ loki-config.yaml
â”œâ”€â”€ scripts/
â”‚   â”œâ”€â”€ backup.sh
â”‚   â””â”€â”€ restore.sh
â”œâ”€â”€ docs/
â”‚   â”œâ”€â”€ diagram.drawio
â”‚   â”œâ”€â”€ checklist.md
â”‚   â””â”€â”€ README.md
â””â”€â”€ src/          # ÑÑ‚Ğ°Ñ‚Ğ¸ĞºĞ° ÑĞ°Ğ¹Ñ‚Ğ°
```
