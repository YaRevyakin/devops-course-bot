---
tags:
  - mod6
---
# –ü—Ä–æ–µ–∫—Ç: –û—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–∞—è –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

–¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞ ‚Äî —Å–æ–∑–¥–∞—Ç—å –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤—É—é —Å–∏—Å—Ç–µ–º—É –∏–∑ –¥–≤—É—Ö –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–æ–≤ –∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∞ —Å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–º –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ–º –ø—Ä–∏ —Å–±–æ–µ. –≠—Ç–æ –∏–º–∏—Ç–∏—Ä—É–µ—Ç —Ä–µ–∞–ª—å–Ω—É—é production-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É.
## üîß –≠—Ç–∞–ø—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ —Å–µ—Ä–≤–µ—Ä–æ–≤
- –†–∞–∑–≤–µ—Ä–Ω–∏ **3 –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã**:
  - `lb1` ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫ (HAProxy)
  - `web1`, `web2` ‚Äî –≤–µ–±-—Å–µ—Ä–≤–µ—Ä—ã (Nginx —Å –ø—Ä–æ—Å—Ç—ã–º HTML)

–ü—Ä–∏–º–µ—Ä —Å–æ–¥–µ—Ä–∂–∏–º–æ–≥–æ `/var/www/html/index.html`:
```html
<h1>–°–µ—Ä–≤–µ—Ä web1</h1>
```
(–Ω–∞ `web2` ‚Äî –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ, –Ω–æ —Å `web2`)
### 2. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ HAProxy –Ω–∞ lb1

–§–∞–π–ª `/etc/haproxy/haproxy.cfg`:
```haproxy
frontend http-in
  bind *:80
  default_backend servers

backend servers
  balance roundrobin
  server web1 192.168.10.10:80 check
  server web2 192.168.10.20:80 check
```
‚Üí –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏: `systemctl restart haproxy`

–ü—Ä–æ–≤–µ—Ä–∫–∞:
```bash
curl http://192.168.10.100  # –¥–æ–ª–∂–µ–Ω —á–µ—Ä–µ–¥–æ–≤–∞—Ç—å –æ—Ç–≤–µ—Ç—ã –æ—Ç web1 –∏ web2
```
### 3. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∞

- –£—Å—Ç–∞–Ω–æ–≤–∏ **Keepalived** –Ω–∞ `lb1` –∏ `lb2` (–≤—Ç–æ—Ä–æ–π –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫)
- –ù–∞—Å—Ç—Ä–æ–π –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π IP (VIP): `192.168.10.100`

–ö–æ–Ω—Ñ–∏–≥ `/etc/keepalived/keepalived.conf` (–Ω–∞ `lb1`):
```conf
vrrp_instance VI_1 {
  state MASTER
  interface eth0
  virtual_router_id 51
  priority 100
  advert_int 1
  authentication {
    auth_type PASS
    auth_pass secret123
  }
  virtual_ipaddress {
    192.168.10.100
  }
}
```
–ù–∞ `lb2` ‚Äî —Ç–æ –∂–µ —Å–∞–º–æ–µ, –Ω–æ `state BACKUP`, `priority 90`.

‚Üí –ü—Ä–∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–µ `lb1` VIP –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–π–¥—ë—Ç –Ω–∞ `lb2` –∑–∞ 1‚Äì3 —Å–µ–∫—É–Ω–¥—ã.
### 4. –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏

- –û—Å—Ç–∞–Ω–æ–≤–∏ `web1`: `systemctl stop nginx` ‚Üí —Ç—Ä–∞—Ñ–∏–∫ –ø–æ–π–¥—ë—Ç —Ç–æ–ª—å–∫–æ –Ω–∞ `web2`
- –û—Å—Ç–∞–Ω–æ–≤–∏ `lb1`: `systemctl stop keepalived` ‚Üí VIP –ø–µ—Ä–µ–π–¥—ë—Ç –Ω–∞ `lb2`, —Å–µ—Ä–≤–∏—Å –æ—Å—Ç–∞–Ω–µ—Ç—Å—è –¥–æ—Å—Ç—É–ø–µ–Ω

> –ò—Å–ø–æ–ª—å–∑—É–π `ping` –∏ `curl` –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –Ω–µ–ø—Ä–µ—Ä—ã–≤–Ω–æ—Å—Ç–∏.
## üí° –ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ?

> –≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç –∫–ª—é—á–µ–≤—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏:
> 
> - **–†–µ–∑–µ—Ä–≤–∏—Ä–æ–≤–∞–Ω–∏–µ** (–¥–≤–∞ –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤—â–∏–∫–∞, –¥–≤–∞ –≤–µ–±-—Å–µ—Ä–≤–µ—Ä–∞)
> - **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π failover** (Keepalived + health checks)
> - **–ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–µ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ** (–ª—ë–≥–∫–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö —Å–µ—Ä–≤–µ—Ä–æ–≤)
## ‚ö†Ô∏è –°–æ–≤–µ—Ç—ã

- –£–±–µ–¥–∏—Å—å, —á—Ç–æ –≤—Å–µ VM –≤ –æ–¥–Ω–æ–π —Å–µ—Ç–∏ –∏ –º–æ–≥—É—Ç –æ–±—â–∞—Ç—å—Å—è
- –û—Ç–∫–ª—é—á–∏ —Ñ–∞–µ—Ä–≤–æ–ª (`ufw disable`) –¥–ª—è —É–ø—Ä–æ—â–µ–Ω–∏—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –ò—Å–ø–æ–ª—å–∑—É–π —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ IP –¥–ª—è —Å–µ—Ä–≤–µ—Ä–æ–≤
- –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞: –¥–æ–±–∞–≤—å TLS, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥, –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ

---
### –°–Ω–æ—Å–∫–∏

[^vip]: Virtual IP (VIP) ‚Äî –∫–ª—é—á–µ–≤–æ–π —ç–ª–µ–º–µ–Ω—Ç –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç–∏: –∫–ª–∏–µ–Ω—Ç—ã –≤—Å–µ–≥–¥–∞ –æ–±—Ä–∞—â–∞—é—Ç—Å—è –∫ –æ–¥–Ω–æ–º—É IP, –¥–∞–∂–µ –µ—Å–ª–∏ —Ñ–∏–∑–∏—á–µ—Å–∫–∏–π —Å–µ—Ä–≤–µ—Ä –º–µ–Ω—è–µ—Ç—Å—è.