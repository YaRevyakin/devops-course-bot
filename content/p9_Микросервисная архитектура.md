---
tags:
  - mod9
---
# –ü—Ä–æ–µ–∫—Ç: –ú–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–¶–µ–ª—å –ø—Ä–æ–µ–∫—Ç–∞ ‚Äî —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å –¥–≤–∞ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–∞ –≤ Kubernetes, –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –º–µ–∂–¥—É –Ω–∏–º–∏ —Å–≤—è–∑—å —á–µ—Ä–µ–∑ Service, –¥–æ–±–∞–≤–∏—Ç—å API Gateway –∏ –±–∞–∑–æ–≤—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥. –≠—Ç–æ –∏–º–∏—Ç–∏—Ä—É–µ—Ç production-—Å—Ü–µ–Ω–∞—Ä–∏–π —Å –Ω–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å—é –∏ –æ—Ç–∫–∞–∑–æ—É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å—é.
## üîß –≠—Ç–∞–ø—ã –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤

**–°–µ—Ä–≤–∏—Å A: `user-service`**  
- –û—Ç–¥–∞—ë—Ç JSON: `{"id": 1, "name": "Alice"}`
- –ü–æ—Ä—Ç: `8000`
- Dockerfile:
  ```dockerfile
  FROM python:3.11-slim
  COPY . /app
  RUN pip install flask
  CMD ["python", "/app/app.py"]
  ```

**–°–µ—Ä–≤–∏—Å B: `order-service`**

- –ü—Ä–∏ –∑–∞–ø—Ä–æ—Å–µ `/orders/1` –≤—ã–∑—ã–≤–∞–µ—Ç `http://user-service:8000/users/1`
- –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç: `{"order_id": 1, "user": {"id": 1, "name": "Alice"}}`
- –ü–æ—Ä—Ç: `8001`

> –û–±–∞ —Å–µ—Ä–≤–∏—Å–∞ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å **stateless** –∏ —Å–ª—É—à–∞—Ç—å –Ω–∞ `0.0.0.0`.
---
### 2. –°–±–æ—Ä–∫–∞ –∏ –ø—É–±–ª–∏–∫–∞—Ü–∏—è –æ–±—Ä–∞–∑–æ–≤
```bash
docker build -t user-service:v1 .
docker build -t order-service:v1 .

# –ó–∞–≥—Ä—É–∑–∏ –≤ registry (Docker Hub, GHCR –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω—ã–π)
docker tag user-service:v1 yourname/user-service:v1
docker push yourname/user-service:v1
# ... –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ –¥–ª—è order-service
```
### 3. –†–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ –≤ Kubernetes
#### user-service.yaml
```yaml
apiVersion: apps/v1
kind: Deployment
meta
  name: user-service
spec:
  replicas: 2
  selector:
    matchLabels:
      app: user
  template:
    meta
      labels:
        app: user
    spec:
      containers:
      - name: app
        image: yourname/user-service:v1
        ports:
        - containerPort: 8000
---
apiVersion: v1
kind: Service
meta
  name: user-service
spec:
  selector:
    app: user
  ports:
    - port: 8000
      targetPort: 8000
```
#### `order-service.yaml` ‚Äî –∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ, —Å —Å—Å—ã–ª–∫–æ–π –Ω–∞ `user-service`

–ü—Ä–∏–º–µ–Ω–∏:
```bash
kubectl apply -f user-service.yaml
kubectl apply -f order-service.yaml
```
‚Üí –¢–µ–ø–µ—Ä—å `order-service` –º–æ–∂–µ—Ç –æ–±—Ä–∞—â–∞—Ç—å—Å—è –∫ `http://user-service:8000` –ø–æ DNS-–∏–º–µ–Ω–∏.
### 4. –î–æ–±–∞–≤–ª–µ–Ω–∏–µ API Gateway (Ingress)

–£—Å—Ç–∞–Ω–æ–≤–∏ Ingress Controller (–µ—Å–ª–∏ –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω):
```bash
minikube addons enable ingress  # –¥–ª—è Minikube
```

#### ingress.yaml
```yaml
apiVersion: networking.k8s.io/v1
kind: Ingress
meta
  name: api-gateway
spec:
  rules:
  - http:
      paths:
      - path: /users
        pathType: Prefix
        backend:
          service:
            name: user-service
            port:
              number: 8000
      - path: /orders
        pathType: Prefix
        backend:
          service:
            name: order-service
            port:
              number: 8001
```

–ü—Ä–æ–≤–µ—Ä–∫–∞:
```bash
curl http://<INGRESS_IP>/orders/1
# –î–æ–ª–∂–µ–Ω –≤–µ—Ä–Ω—É—Ç—å –¥–∞–Ω–Ω—ã–µ —Å –≤–ª–æ–∂–µ–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º
```
### 5. –ë–∞–∑–æ–≤—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

#### –£—Å—Ç–∞–Ω–æ–≤–∫–∞ Prometheus + Grafana (—á–µ—Ä–µ–∑ Helm)
```bash
helm repo add prometheus-community https://prometheus-community.github.io/helm-charts
helm install monitoring prometheus-community/kube-prometheus-stack
```
#### –ü—Ä–æ–≤–µ—Ä–∫–∞:

- –ó–∞–π–¥–∏ –≤ Grafana (`kubectl port-forward svc/monitoring-grafana 3000:80`)
- –ò–º–ø–æ—Ä—Ç–∏—Ä—É–π –¥–∞—à–±–æ—Ä–¥ **"Kubernetes / Compute Resources / Namespace (Pods)"**
- –£–±–µ–¥–∏—Å—å, —á—Ç–æ –æ–±–∞ —Å–µ—Ä–≤–∏—Å–∞ –æ—Ç–æ–±—Ä–∞–∂–∞—é—Ç—Å—è

> –î–ª—è –ø—Ä–æ–¥–≤–∏–Ω—É—Ç–æ–≥–æ —É—Ä–æ–≤–Ω—è: –¥–æ–±–∞–≤—å custom metrics (–Ω–∞–ø—Ä–∏–º–µ—Ä, RPS) —á–µ—Ä–µ–∑ `prometheus_client`.
---
## üí° –ü–æ—á–µ–º—É —ç—Ç–æ –≤–∞–∂–Ω–æ?

> –≠—Ç–æ—Ç –ø—Ä–æ–µ–∫—Ç –æ—Ö–≤–∞—Ç—ã–≤–∞–µ—Ç –∫–ª—é—á–µ–≤—ã–µ –∞—Å–ø–µ–∫—Ç—ã –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω–æ–π –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—ã:
> 
> - **–ù–µ–∑–∞–≤–∏—Å–∏–º–æ–µ —Ä–∞–∑–≤—ë—Ä—Ç—ã–≤–∞–Ω–∏–µ**
> - **–°–µ—Ç–µ–≤–∞—è –∏–∑–æ–ª—è—Ü–∏—è —á–µ—Ä–µ–∑ Service**
> - **–ï–¥–∏–Ω–∞—è —Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ (API Gateway)**
> - **–ù–∞–±–ª—é–¥–∞–µ–º–æ—Å—Ç—å** ‚Äî –±–µ–∑ –Ω–µ—ë –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å—ã ‚Äî ¬´—á—ë—Ä–Ω—ã–π —è—â–∏–∫¬ª

## ‚ö†Ô∏è –°–æ–≤–µ—Ç—ã

- –ò—Å–ø–æ–ª—å–∑—É–π **readinessProbe** –∏ **livenessProbe** –≤ production
- –î–æ–±–∞–≤—å **ResourceQuotas** –∏ **LimitRanges**
- –î–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞: –Ω–∞—Å—Ç—Ä–æ–π **Network Policies** –∏ **mTLS** (—á–µ—Ä–µ–∑ Istio/Linkerd)

---
### –°–Ω–æ—Å–∫–∏

[^service-dns]: –í Kubernetes –∫–∞–∂–¥—ã–π Service –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–æ–ª—É—á–∞–µ—Ç DNS-–∏–º—è –≤–∏–¥–∞ `my-service.namespace.svc.cluster.local`. –í–Ω—É—Ç—Ä–∏ namespace ‚Äî –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –∏–º–µ–Ω–∏ —Å–µ—Ä–≤–∏—Å–∞.