---
tags:
  - mod8
---
# Best Practices

–ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤ DevOps —Å—Ç—Ä–æ–∏—Ç—Å—è –Ω–∞ **–∞–≤—Ç–æ–º–∞—Ç–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö, –ø—Ä–æ–≤–µ—Ä–µ–Ω–Ω—ã—Ö –ø—Ä–∞–∫—Ç–∏–∫–∞—Ö**, –∫–æ—Ç–æ—Ä—ã–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –Ω–∞ –≤—Å–µ—Ö —É—Ä–æ–≤–Ω—è—Ö: –æ—Ç –û–° –¥–æ CI/CD. –í–æ—Ç –∫–ª—é—á–µ–≤—ã–µ –ø–æ–¥—Ö–æ–¥—ã, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–µ–Ω –∑–Ω–∞—Ç—å –∫–∞–∂–¥—ã–π DevOps-–∏–Ω–∂–µ–Ω–µ—Ä.
## üîí –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –≤ Linux

### –ü—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞
- –ò—Å–ø–æ–ª—å–∑—É–π –ø—Ä–∏–Ω—Ü–∏–ø –Ω–∞–∏–º–µ–Ω—å—à–∏—Ö –ø—Ä–∏–≤–∏–ª–µ–≥–∏–π:  
  ```bash
  chmod 600 secret.key    # —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü ‚Äî —á—Ç–µ–Ω–∏–µ/–∑–∞–ø–∏—Å—å
  chmod 644 config.yaml   # –≤—Å–µ ‚Äî —á—Ç–µ–Ω–∏–µ, –≤–ª–∞–¥–µ–ª–µ—Ü ‚Äî –∑–∞–ø–∏—Å—å
  ```
- –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –∑–∞–ø—É—Å–∫–∞–π —Å–µ—Ä–≤–∏—Å—ã –æ—Ç root. –°–æ–∑–¥–∞–≤–∞–π –æ—Ç–¥–µ–ª—å–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:
```bash
useradd -r -s /bin/false appuser
```

### SELinux / AppArmor

- **SELinux** (RHEL/CentOS) –∏ **AppArmor** (Ubuntu) ‚Äî –º–∞–Ω–¥–∞—Ç–Ω—ã–µ —Å–∏—Å—Ç–µ–º—ã –∫–æ–Ω—Ç—Ä–æ–ª—è –¥–æ—Å—Ç—É–ø–∞
- –ë–ª–æ–∫–∏—Ä—É—é—Ç –¥–µ–π—Å—Ç–≤–∏—è –¥–∞–∂–µ –æ—Ç root, –µ—Å–ª–∏ –æ–Ω–∏ –Ω–µ —Ä–∞–∑—Ä–µ—à–µ–Ω—ã –ø–æ–ª–∏—Ç–∏–∫–æ–π
- –ü—Ä–∏–º–µ—Ä: –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä –Ω–µ –º–æ–∂–µ—Ç —á–∏—Ç–∞—Ç—å `/etc/shadow`, –¥–∞–∂–µ —Å `--privileged` (–µ—Å–ª–∏ –ø–æ–ª–∏—Ç–∏–∫–∞ –∑–∞–ø—Ä–µ—â–∞–µ—Ç)
### –ê—É–¥–∏—Ç —á–µ—Ä–µ–∑ auditd

- –õ–æ–≥–∏—Ä—É–µ—Ç –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ —Å–∏—Å—Ç–µ–º–Ω—ã–µ –≤—ã–∑–æ–≤—ã:
```bash
auditctl -w /etc/passwd -p wa -k identity
```
- –ü–æ–∑–≤–æ–ª—è–µ—Ç –æ—Ç—Å–ª–µ–¥–∏—Ç—å: –∫—Ç–æ, –∫–æ–≥–¥–∞ –∏ —á—Ç–æ –∏–∑–º–µ–Ω–∏–ª
>–í –æ–±–ª–∞–∫–µ: –∏—Å–ø–æ–ª—å–∑—É–π hardened-–æ–±—Ä–∞–∑—ã (CIS Benchmark).

## üõ°Ô∏è –°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ —É—è–∑–≤–∏–º–æ—Å—Ç–µ–π

|–ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç|–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ|–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è|
|---|---|---|
|**Trivy**|–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –æ–±—Ä–∞–∑–æ–≤, —Ñ–∞–π–ª–æ–≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π, IaC|CLI, CI, Kubernetes operator|
|**Snyk**|SCA + –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä—ã + IaC|CLI, GitHub, GitLab, IDE|
|**Clair**|–°–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ Docker-–æ–±—Ä–∞–∑–æ–≤|Registry (Quay), standalone|

–ü—Ä–∏–º–µ—Ä –≤ CI:
```yaml
- name: Scan image
  run: trivy image --severity CRITICAL myapp:v1
```
‚Üí –ï—Å–ª–∏ –Ω–∞–π–¥–µ–Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∞—è —É—è–∑–≤–∏–º–æ—Å—Ç—å ‚Äî pipeline –ø–∞–¥–∞–µ—Ç.

## üîë HashiCorp Vault ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–µ–∫—Ä–µ—Ç–∞–º–∏

### –ó–∞—á–µ–º?

- –•—Ä–∞–Ω–µ–Ω–∏–µ —Ç–æ–∫–µ–Ω–æ–≤, –ø–∞—Ä–æ–ª–µ–π, —Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç–æ–≤ **–≤–Ω–µ –∫–æ–¥–∞ –∏ –∫–æ–Ω—Ñ–∏–≥–æ–≤**
- –î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏–µ —Å–µ–∫—Ä–µ—Ç—ã: –≤—Ä–µ–º–µ–Ω–Ω—ã–µ –∫—Ä–µ–¥—ã –¥–ª—è –ë–î
- –ê—É–¥–∏—Ç: –∫—Ç–æ –∑–∞–ø—Ä–æ—Å–∏–ª —Å–µ–∫—Ä–µ—Ç –∏ –∫–æ–≥–¥–∞

### –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç?

1. –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Å–µ–∫—Ä–µ—Ç —á–µ—Ä–µ–∑ API Vault
2. Vault –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –ø–æ–ª–∏—Ç–∏–∫—É –∏ –≤—ã–¥–∞—ë—Ç –¥–∞–Ω–Ω—ã–µ
3. –í—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ –ª–æ–≥–∏—Ä—É—é—Ç—Å—è

–ü—Ä–∏–º–µ—Ä –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ Kubernetes:
```yaml
env:
  - name: DB_PASSWORD
    valueFrom:
      secretKeyRef:
        name: db-secret
        key: password
```
–°–µ–∫—Ä–µ—Ç `db-secret` —Å–æ–∑–¥–∞—ë—Ç—Å—è —á–µ—Ä–µ–∑ Vault Agent –∏–ª–∏ CSI driver.
> –ù–∏–∫–æ–≥–¥–∞ –Ω–µ —Ö—Ä–∞–Ω–∏—Ç–µ —Å–µ–∫—Ä–µ—Ç—ã –≤ `.env`, `config.yaml` –∏–ª–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö CI –±–µ–∑ —à–∏—Ñ—Ä–æ–≤–∞–Ω–∏—è.

## ‚ö†Ô∏è –†–∞—Å–ø—Ä–æ—Å—Ç—Ä–∞–Ω—ë–Ω–Ω—ã–µ –æ—à–∏–±–∫–∏

- ‚ùå ¬´–Ø –∏—Å–ø–æ–ª—å–∑—É—é `chmod 777` –¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞¬ª  
    ‚Üí –≠—Ç–æ –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –¥–æ—Å—Ç—É–ø –≤—Å–µ–º. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `600`/`644`.
- ‚ùå ¬´–°–∫–∞–Ω–∏—Ä—É—é —Ç–æ–ª—å–∫–æ production-–æ–±—Ä–∞–∑—ã¬ª  
    ‚Üí –°–∫–∞–Ω–∏—Ä—É–π—Ç–µ **–Ω–∞ –∫–∞–∂–¥–æ–º —ç—Ç–∞–ø–µ**: dev ‚Üí build ‚Üí deploy.
- ‚ùå ¬´Vault —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –Ω–æ —Å–µ–∫—Ä–µ—Ç—ã –≤—Å—ë –µ—â—ë –≤ Git¬ª  
    ‚Üí –ú–∏–≥—Ä–∏—Ä—É–π—Ç–µ –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ: —Å–Ω–∞—á–∞–ª–∞ –Ω–æ–≤—ã–µ —Å–µ–∫—Ä–µ—Ç—ã ‚Äî —Ç–æ–ª—å–∫–æ –≤ Vault.

## üí° –ì–ª–∞–≤–Ω–æ–µ

> –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å ‚Äî —ç—Ç–æ **–∫—É–ª—å—Ç—É—Ä–∞ –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏–∏ –∏ –¥–∏—Å—Ü–∏–ø–ª–∏–Ω—ã**.  
> –õ—É—á—à–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ —Ä–∞–±–æ—Ç–∞—é—Ç —Ç–æ–ª—å–∫–æ —Ç–æ–≥–¥–∞, –∫–æ–≥–¥–∞ –æ–Ω–∏ **–≤—Å—Ç—Ä–æ–µ–Ω—ã –≤ –ø—Ä–æ—Ü–µ—Å—Å**, –∞ –Ω–µ –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è ¬´–ø–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏¬ª.